<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\NexoAtendimentoController;
use App\Http\Controllers\NexoGerencialController;
use App\Http\Controllers\NexoDataJuriController;

Route::middleware(['auth'])->group(function () {
    Route::prefix('nexo/atendimento')->group(function () {
        // ── Rotas existentes (INTOCADAS) ──────────────────────────────
        Route::get('/', [NexoAtendimentoController::class, 'index'])->name('nexo.atendimento');
        Route::get('/conversas', [NexoAtendimentoController::class, 'conversas'])->name('nexo.atendimento.conversas');
        Route::get('/conversas/{id}', [NexoAtendimentoController::class, 'conversa'])->name('nexo.atendimento.conversa')->whereNumber('id');
        Route::post('/conversas/{id}/mensagens', [NexoAtendimentoController::class, 'enviarMensagem'])->name('nexo.atendimento.enviar')->whereNumber('id');
        Route::get('/conversas/{id}/poll', [NexoAtendimentoController::class, 'pollMessages'])->name('nexo.atendimento.poll')->whereNumber('id');
        Route::patch('/conversas/{id}/assign', [NexoAtendimentoController::class, 'assignUser'])->name('nexo.atendimento.assign')->whereNumber('id');
        Route::patch('/conversas/{id}/status', [NexoAtendimentoController::class, 'changeStatus'])->name('nexo.atendimento.status')->whereNumber('id');
        Route::post('/conversas/{id}/link-lead', [NexoAtendimentoController::class, 'linkLead'])->name('nexo.atendimento.link-lead')->whereNumber('id');
        Route::post('/conversas/{id}/link-cliente', [NexoAtendimentoController::class, 'linkCliente'])->name('nexo.atendimento.link-cliente')->whereNumber('id');
        Route::get('/conversas/{id}/contexto', [NexoAtendimentoController::class, 'contexto360'])->name('nexo.atendimento.contexto')->whereNumber('id');

        // ── Rotas DataJuri (NOVAS — v2026.02.07) ──────────────────────
        Route::get('/conversas/{id}/contexto-datajuri', [NexoDataJuriController::class, 'contextoDataJuri'])->name('nexo.atendimento.contexto-datajuri')->whereNumber('id');
        Route::get('/conversas/{id}/buscar-clientes', [NexoDataJuriController::class, 'buscarClientes'])->name('nexo.atendimento.buscar-clientes')->whereNumber('id');
        Route::post('/conversas/{id}/auto-vincular-cliente', [NexoDataJuriController::class, 'autoVincularCliente'])->name('nexo.atendimento.auto-vincular')->whereNumber('id');
        Route::post('/conversas/{id}/link-processo', [NexoDataJuriController::class, 'linkProcesso'])->name('nexo.atendimento.link-processo')->whereNumber('id');
        Route::delete('/conversas/{id}/unlink-processo', [NexoDataJuriController::class, 'unlinkProcesso'])->name('nexo.atendimento.unlink-processo')->whereNumber('id');
        Route::get('/conversas/{id}/prazos-filtrados', [NexoDataJuriController::class, 'prazosFiltrados'])->name('nexo.atendimento.prazos-filtrados')->whereNumber('id');
    });

    Route::prefix('nexo/gerencial')->group(function () {
        Route::get('/', [NexoGerencialController::class, 'index'])->name('nexo.gerencial');
        Route::get('/data', [NexoGerencialController::class, 'data'])->name('nexo.gerencial.data');
    });
});
